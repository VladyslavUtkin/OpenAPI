# Інтеграція Swagger з документацією


Всякий раз, коли обговорюються Swagger і інші специфікації REST API, технічні письменники незмінно запитують, як вони можуть інтегрувати вихідні дані Swagger з іншою частиною своєї документації. Коли мова йде про Swagger, це питання обговорюється серед технічних письменників набагато частіше за інших.


## Єдине джерело істини

Коли ми поміщаємо документацію в інший вихідний файл - в даному випадку в файл YAML або JSON, включений в набір файлів Swagger UI, в кінцевому підсумку розбиваємо свій єдине джерело істини на кілька джерел. Кінцеві точки і параметри вже визначені в звичайній документації, і тепер їх потрібно перенести в специфікацію OpenAPI. Ви копіюєте і вставляєте однакові параметри і іншу інформацію на обох сайтах? Ви якось генеруєте опису з одного і того ж джерела?

Ця головоломка зазвичай кристально ясна для технічних авторів. Документація API складається не тільки з адресного матеріалу про API. Також є інформація про отримання ключів API, встановлення та налаштування сервісів, або інші відомості, які не відповідають специфікації.


Може бути складним завданням додати опису всіх параметрів, виділених в специфікації OpenAPI, якщо таких даних дуже багато в адресних розділах документації. На жаль, простого рішення для створення єдиного джерела істини не існує. Ось кілька варіантів:

- [Варіант 1. Інтеграція Swagger UI в свої документи](#embed)
- [Варіант 2: Розмістити всю інформацію в специфікацію в згортаються розділах](#put)
- [Варіант 3: Парс документ в специфікації OpenAPI](#parse)
- [Варіант 4. Зберігати вміст в YAML форматі](#yaml)
- [Варіант 5: Використовувати інструмент, який імпортує Swagger і дозволяє працювати з іншою документацією](#multitool)
- [Варіант 6: Змінити перспективи - наявність двох сайтів не так уже й погано](#breake)

<a name="embed"></a>
## Варіант 1. Вбудовувати Swagger UI в свої документи

Одним з рішень є впровадження Swagger UI безпосередньо в документацію. Приклад цього тут: Swagger UI Demo. Вставити Swagger в HTML-сторінку досить легко. Остання версія Swagger має більш чуйний, гнучкий дизайн. Так і проситься бути вбудованим в інший сайт.

Єдина проблема з варіантом вбудовування полягає в тому, що деякі з моделей не обмежені в своєму контейнері, тому вони розширюються за межі контейнера. Спробуйте розширити розділ «Модель» в демоверсії - буде зрозуміло, про що мова.

Може бути джедай стилів і зміг би змінити таку поведінку. Можливо, але падаван, який не сильний в стилях, не може вирішити таку проблему. В Swagger UI Demo додані декілька призначених для користувача стилів, для внесення змін до інтерфейс Swagger в різних місцях. Якщо переглянути вихідний код цієї сторінки і вивчати другу блок `<style>`, можна побачити додані стилі.

Завдяки вбудованому параметру все одно можна використовувати офіційний інструментарій Swagger UI для читання специфікації, і включати висновок Swagger UI в основну документацію. Swagger UI читає останню версію специфікації OpenAPI, яку багато інструментів ще не підтримують. Крім того, інтерфейс Swagger має знайомий інтерфейс, з яким розробники API, вже знайомі. Але, якщо стилістика потворним чином перетинається в розділах моделі, можна не використовувати підходу вбудовування документації.

<a name="put"></a>
## Варіант 2: Розміщуємо всю інформацію в специфікацію в згортаються розділах

Цей варіант передбачає спробу помістити всю інформацію в сам документ специфікації. Дивно, скільки інформації можна включити в специфікацію. Будь-який елемент `description` (не тільки властивість` description` в об'єкті `info`) дозволяє використовувати Markdown і HTML. Наприклад, ось об'єкт `info` в специфікації OpenAPI, де з'являється опис. (При бажанні можна набрати `>`, для перекладу на наступний рядок, а потім зробити відступ в два пробілу. Можна додати багато вмісту в елементах `description`.)

```yaml
info:
  title: OpenWeatherMap API
  description: 'Get the current weather, daily forecast for 16 days, and a three-hour-interval forecast for 5 days for your city. Helpful stats, graphics, and this day in history charts are available for your reference. Interactive maps show precipitation, clouds, pressure, wind around your location. Data is available in JSON, XML, or HTML format. **Note**: This sample Swagger file covers the `weather` endpoint only from the OpenWeatherMap API. <br/><br/> **Tip**: We recommend that you call the API by city ID (using the `id` parameter) to get unambiguous results for your city.'
  version: '2.5'
```

Можна робити посилання на Bootstrap CSS і JS в заголовку `index.html` проекту Swagger UI, і потім включати попередження Bootstrap і кнопки розкриття / згортання в елементі` description`. Ось приклад:

```yaml
info:
  description: >
    ACME offers a lot of configuration options...
    <div class="alert alert-success" role="alert"><i class="fa fa-info-circle"></i> <b>Tip: </b>See the resources available in the portal for more detail.</div>
    <div class="alert alert-warning" role="alert"><i class="fa fa-info-circle"></i> <b>Note: </b>The  network includes a firewall that protects your access to the resources...</div>

    <div class="container">
    <div class="apiConfigDetails">
    <button type="button" class="btn btn-warning" data-toggle="collapse" data-target="#demo">
    <span class="glyphicon glyphicon-collapse-down"></span> See API Configuration Details
    </button>
    <div id="demo" class="collapse">

    <h2>Identifiers Allowed</h2>

    <p>Based on this configuration, ACME will accept any of the following identifiers in requests.</p>

    <table class="table">
    <thead>
    <tr>
    <th>Request Codes</th>
    <th>Data Type</th>
    <th>Comparison Method</th>
    </tr>
    </thead>
    <tbody>
    <tr>
    ...
```

Результатом буде стиснення здебільшого інформації в одну кнопку, яка при натисканні розгорталася, видаючи більш детальну інформацію. Включаючи розділи «розгорнути / згорнути» з Bootstrap, можна додати масу інформації в об'єкт `description`. (Для необхідного JavaScript треба додати теги `<script>` в заголовок або футер того ж файлу `index.html`, де ми посилалися на файл` openapi.yaml`)

Крім того, можна включити модальні вікна, які з'являються при натисканні. Модальні вікна - це діалогові вікна, які затемнюють фон за межами діалогового вікна. Знову ж, весь необхідний JavaScript-код можна включати в файл `index.html` проекту Swagger UI.

Якщо включити Bootstrap, ймовірно, буде потрібно обмежити простір імен, щоб воно не впливало на інші елементи в відображенні Swagger UI. (Детальніше про те, як це зробити, див. В розділі [ «How to Isolate Bootstrap CSS to Avoid Conflicts»](https://formden.com/blog/isolate-bootstrap).)

В цілому, якщо документація API відносно невелика, можна спочатку спробувати помістити всю свою інформацію в специфікації. Якщо є складний API або просто API, який містить багато додаткової інформації, що не відноситься до специфікації, треба шукати альтернативні підходи. Але спробуйте спочатку вписати його в специфікацію. Це збереже інформацію в одному місці.

У використанні специфікації багато переваг, які легко втратити, якщо вибрати інший підхід. Багато інструменти можуть аналізувати специфікацію і генерувати інтерактивні дисплеї якщо зберігати інформацію в специфікації.

Переклад контенту в формат специфікації OpenAPI дозволяє відокремлювати контент від рівня представлення, миттєво використовуючи переваги будь-якого нового інструментарію API або платформи, які можуть аналізувати специфікацію.

<a name="parse"></a>
## Варіант 3: Парс (аналізуємо) документ в специфікації OpenAPI

Якщо використовується інструмент, такий як Jekyll, що включає мову під назвою Liquid, можна використовувати інстанси Liquid для Jekyll, для читання документації специфікації OpenAPI (який, врешті-решт, просто синтаксис YAML). Наприклад, можна використовувати [цикл `for`](https://learn.cloudcannon.com/jekyll/looping-in-liquid/) для ітерації значень специфікації OpenAPI. У прикладі нижче файл `swagger.yml` зберігається в каталозі` _data Jekyll`.

```html
<table>
    <thead>
    <tr><th>Name</th><th>Type</th><th>Description</th><th>Required?</th></tr>
    </thead>
    {% for parameter in site.data.swagger.paths.get.parameters %}
        {% if parameter.in == "query" %}
        <tr>
            <td><code>{{ parameter.name }}</code></td>
            <td><code>{{ parameter.type }}</code></td>
            <td>
            {% assign found = false %}
            {% for param in site.data.swagger.paths.get.parameters %}
                {% if parameter.name == param.name %}
                    {{ param.description }}
                    {% assign found = true %}
                {% endif %}
            {% endfor %}
            {% if found == false %}
                ** New parameter **
            {% endif %}
            </td>
            <td><code>{{ parameter.required }}</code></td>
        </tr>
        {% endif %}
    {% endfor %}
</table>
```


<a name="yaml"></a>
## Варіант 4. Зберігаємо вміст в YAML форматі

Інший підхід до інтеграції вихідних даних Swagger з іншими документами може полягати в тому, щоб зберігати опису та іншу інформацію в файлах даних YAML в проекті, а потім включати посилання на дані в документ специфікації. Розглянемо приклад з використанням Jekyll (але аналогічні методи існують для інших генераторів статичних сайтів).


Jekyll дозволяє зберігати вміст в файлах YAML в папці `_data`. Припустимо, всередині `_data` є файл` parameters.yml` наступного змісту:

`` `Yaml
acme_parameter:>
  This is a description of my parameter ...
`` `

Потім можна обернути це посилання у такі теги:

`` `
{{Site.data.parameters.acme_parameter}}
`` `

У проекті Jekyll посилання на специфікацію виглядала б наступним чином:

`` `Yaml
info:
  description:>
    {{Site.data.parameters.acme_parameter}}
`` `

Після беремо висновок з Jekyll, який містить контент, вставлений в кожне властивість специфікації. У цій моделі відбувається генерація специфікацію OpenAPI з проекту Jekyll.


Не поганий варіант, але важко гарантувати, що специфікація OpenAPI залишиться дійсною, поки пишеться контент. При наявності подібних посилань у змісті специфікації ( `{{site.data.parameters.acme_parameter}}`), не вийде скористатися перевіркою специфікації в реальному часі в [Swagger](https://swagger.io/tools/swagger-editor/ ).

Швидше за все, доведеться підключити весь проект Swagger UI до сайту Jekyll. Вгорі файлу `Swagger.yml` потрібно додати frontmatter з` layout: null`, щоб Jekyll обробив файл:

```Yaml
---
layout: null
---
```

У команді `jekyll serve` конфігуруємо місце призначення (` destination`), щоб перетворити вихідні дані в папку `htdocs`, в якій працює [простий локальний HTTP-сервер](https://developer.mozilla.org/en-US/ docs / Learn / Common_questions / set_up_a_local_testing_server). З кожною збіркою, потрібно перевіряти наявність помилок.

Зберігаючи значення в файлах даних, можна потім включити їх в інше місце в документі. Наприклад, в документі може бути розділ параметрів, в якому також включено опис `{{site.data.parameters.acme_parameter}}`.

Недолік цього підходу в відсутності можливості перевірки специфікації. Складно відстежувати винуватців помилок валідації.

<a name="multitool"></a>
## Варіант 5: Використовуємо інструмент, який імпортує Swagger і дозволяє працювати з іншою документацією

ще один підхід полягає у використанні таких інструментів, як [Readme.io](https://readme.io/) або [Stoplight](https://stoplight.io/), які дозволяють як імпортувати специфікації OpenAPI, так і додавати власні сторінки документації. [Readme.io](https://readme.io/) надає один з найбільш привабливих результатів і повністю включає в себе практично всі функції документації, які можуть знадобитися. [Readme.io](https://readme.io/) вимагає сторонній хостинг, але деякі інші інструментальні документи дозволяють також включити Swagger. Детально вивчали Stoplight в темі: Stoplight - інструменти візуального моделювання для створення вашої специфікації OpenAPI

Такі сайти, як [Apiary](https://apiary.io/) і [Mulesoft](https://www.mulesoft.com/), дозволяють імпортувати специфікації OpenAPI, і додавати власні сторінки документації. Ці сайти пропонують повне управління API-інтерфейсами, тому, якщо розробники вже використовують одну з цих платформ, має сенс також зберігати документацію в цих інструментах.


<a name="breake"></a>
## Варіант 6: Міняємо перспективи - наявність двох сайтів не так уже й погано

Нарешті, запитаємо себе, що поганого в наявності двох різних сайтів? Один сайт з описом адресних розділів, а інший для концептуальної документації. Програмісти можуть порахувати довідкову інформацію на основі Swagger зручною, тому що вона переробляє і спрощує обсяг інформації. Замість величезного сайту для навігації, висновок Swagger надає базову довідкову інформацію, яка їм потрібна. Коли їм потрібна не довідкова інформація, вони можуть звернутися до супровідного керівництву. 

Правда в тому, що програмісти роками працюють з Javadocs, [Doxygen](https://en.wikipedia.org/wiki/Comparison_of_documentation_generators), які генерують документацію з Java, C ++, C #, Python, Ruby та інших мов програмування. Автоматичне створення довідкової інформації з вихідного коду в автономному режимі є надзвичайно поширеним явищем і не повинно сприйматися програмістами як фрагментарна інформація.

Зрештою, замість того, щоб відчувати, що наявність двох висновків фрагментировано або роз'єднане, можна переосмислити свою точку зору. Висновок Swagger надає чітке джерело переходу до довідкової інформації про кінцевих точках, параметрах, запитах і відповідях. Решта документів надають довідкову інформацію. Два цих результату просто стали організаційною стратегією для документації.


